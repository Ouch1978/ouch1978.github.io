function scriptPath(){var e;if(document.currentScript)e=document.currentScript.src;else{var t=document.querySelector('script[src$="/chalkboard/plugin.js"]');t&&(e=t.src)}return void 0===e?"":e.slice(0,e.lastIndexOf("/")+1)}window.RevealChalkboard=window.RevealChalkboard||{id:"RevealChalkboard",init:function(e){initChalkboard(e)},configure:function(e){configure(e)},toggleNotesCanvas:function(){toggleNotesCanvas()},toggleChalkboard:function(){toggleChalkboard()},colorIndex:function(){colorIndex()},colorNext:function(){colorNext()},colorPrev:function(){colorPrev()},clear:function(){clear()},reset:function(){reset()},resetAll:function(){resetAll()},updateStorage:function(){updateStorage()},getData:function(){return getData()},download:function(){download()}};var path=scriptPath();const initChalkboard=function(e){var t,n,a=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){a=!0}}))}catch(De){}var o,r=!1,i=3,s=7,l=1,d=[!0,!1],c={src:path+"img/sponge.png",radius:20},u=[{color:"rgba(100,100,100,1)",cursor:"url("+path+"img/boardmarker-black.png), auto"},{color:"rgba(30,144,255, 1)",cursor:"url("+path+"img/boardmarker-blue.png), auto"},{color:"rgba(220,20,60,1)",cursor:"url("+path+"img/boardmarker-red.png), auto"},{color:"rgba(50,205,50,1)",cursor:"url("+path+"img/boardmarker-green.png), auto"},{color:"rgba(255,140,0,1)",cursor:"url("+path+"img/boardmarker-orange.png), auto"},{color:"rgba(150,0,20150,1)",cursor:"url("+path+"img/boardmarker-purple.png), auto"},{color:"rgba(255,220,0,1)",cursor:"url("+path+"img/boardmarker-yellow.png), auto"}],h=[{color:"rgba(255,255,255,0.5)",cursor:"url("+path+"img/chalk-white.png), auto"},{color:"rgba(96, 154, 244, 0.5)",cursor:"url("+path+"img/chalk-blue.png), auto"},{color:"rgba(237, 20, 28, 0.5)",cursor:"url("+path+"img/chalk-red.png), auto"},{color:"rgba(20, 237, 28, 0.5)",cursor:"url("+path+"img/chalk-green.png), auto"},{color:"rgba(220, 133, 41, 0.5)",cursor:"url("+path+"img/chalk-orange.png), auto"},{color:"rgba(220,0,220,0.5)",cursor:"url("+path+"img/chalk-purple.png), auto"},{color:"rgba(255,220,0,0.5)",cursor:"url("+path+"img/chalk-yellow.png), auto"}],g={toggleNotesCanvas:{keyCode:67,key:"C",description:"Toggle notes canvas"},toggleChalkboard:{keyCode:66,key:"B",description:"Toggle chalkboard"},clear:{keyCode:171,key:"+",description:"Clear drawings on slide"},reset:{keyCode:46,key:"DEL",description:"Reset drawings on slide"},resetAll:{keyCode:8,key:"BACKSPACE",description:"Reset all drawings"},colorNext:{keyCode:88,key:"X",description:"Next color"},colorPrev:{keyCode:89,key:"Y",description:"Previous color"},download:{keyCode:68,key:"D",description:"Download drawings"}},v="chalkboard",p=[0,0],f=!0,m=!0,b=!0,y=!0,w=800,k=!1,C="broadcast",x=D(e.getConfig().chalkboard||{});if(x.keyBindings)for(var E in x.keyBindings)g[E]=x.keyBindings[E];function D(e){if((e.boardmarkerWidth||e.penWidth)&&(i=e.boardmarkerWidth||e.penWidth),e.chalkWidth&&(s=e.chalkWidth),e.chalkEffect&&(l=e.chalkEffect),e.rememberColor&&(d=e.rememberColor),e.eraser&&(c=e.eraser),e.boardmarkers&&(u=e.boardmarkers),e.chalks&&(h=e.chalks),e.theme&&(v=e.theme),"whiteboard"===v)t=["rgba(127,127,127,.1)",path+"img/whiteboard.png"],n=[te,te],pens=[u,u],r={color:"rgb(127,127,255,0.1)",distance:40,width:2};else t=["rgba(127,127,127,.1)",path+"img/blackboard.png"],n=[te,ne],pens=[u,h],r={color:"rgb(50,50,10,0.5)",distance:80,width:2};(e.background&&(t=e.background),null!=e.grid&&(r=e.grid),null!=e.toggleChalkboardButton&&(f=e.toggleChalkboardButton),null!=e.toggleNotesButton&&(m=e.toggleNotesButton),null!=e.colorButtons&&(b=e.colorButtons),null!=e.boardHandle&&(y=e.boardHandle),e.transition&&(w=e.transition),null!=e.readOnly&&(k=e.readOnly),e.messageType&&(C=e.messageType),O&&(e.theme||e.background||e.grid))&&(document.getElementById(O[1].id).style.background='url("'+t[1]+'") repeat',ie(1),se());return e}function S(e){document.querySelectorAll(".pdf-page").length&&null!==F?e():(console.log("Wait for pdf pages to be created and drawings to be loaded"),setTimeout(S,500,e))}f&&((o=document.createElement("div")).className="chalkboard-button",o.id="toggle-chalkboard",o.style.visibility="visible",o.style.position="absolute",o.style.zIndex=30,o.style.fontSize="24px",o.style.left=f.left||"30px",o.style.bottom=f.bottom||"30px",o.style.top=f.top||"auto",o.style.right=f.right||"auto",o.innerHTML='<a href="#" title="Toggle chalkboard ('+g.toggleChalkboard.key+')" onclick="RevealChalkboard.toggleChalkboard(); return false;"><i class="fa fa-pen-square"></i></a>',document.querySelector(".reveal").appendChild(o));m&&((o=document.createElement("div")).className="chalkboard-button",o.id="toggle-notes",o.style.position="absolute",o.style.zIndex=30,o.style.fontSize="24px",o.style.left=m.left||"70px",o.style.bottom=m.bottom||"30px",o.style.top=m.top||"auto",o.style.right=m.right||"auto",o.innerHTML='<a href="#" title="Toggle slide annotation ('+g.toggleNotesCanvas.key+')" onclick="RevealChalkboard.toggleNotesCanvas(); return false;"><i class="fa fa-pen"></i></a>',document.querySelector(".reveal").appendChild(o));var O=[{id:"notescanvas"},{id:"chalkboard"}];j(0),j(1);var T=0,M=0,L=0,A=0,P=null,q=null,I=Date.now(),N={h:0,v:0},R=null,B=[[],[]],W=null,H=null,z=!1;function X(e,t){(!0===t||t>e.length)&&(t=e.length);var n=document.createElement("div");n.classList.add("palette");for(var a=document.createElement("ul"),o=0;o<t;o++){var r=document.createElement("li");r.setAttribute("data-color",o),r.innerHTML='<i class="fa fa-square"></i>',r.style.color=e[o].color,r.addEventListener("click",(function(e){for(var t=e.target;!t.hasAttribute("data-color");)t=t.parentElement;xe(t.getAttribute("data-color"))})),a.appendChild(r)}return n.appendChild(a),n}function j(n){var a=document.createElement("div");if(a.id=O[n].id,a.classList.add("overlay"),a.setAttribute("data-prevent-swipe",""),a.oncontextmenu=function(){return!1},a.style.cursor=pens[n][p[n]].cursor,O[n].width=window.innerWidth,O[n].height=window.innerHeight,O[n].scale=1,O[n].xOffset=0,O[n].yOffset=0,"0"==n){a.style.background="rgba(0,0,0,0)",a.style.zIndex=24,a.style.opacity=1,a.style.visibility="visible",a.style.pointerEvents="none";document.querySelector(".slides");var o=e.getConfig().width/e.getConfig().height;if(O[n].width>O[n].height*o?O[n].xOffset=(O[n].width-O[n].height*o)/2:O[n].height>O[n].width/o&&(O[n].yOffset=(O[n].height-O[n].width/o)/2),b)(r=X(u,b)).style.visibility="hidden",a.appendChild(r)}else{if(a.style.background='url("'+t[n]+'") repeat',a.style.zIndex=26,a.style.opacity=0,a.style.visibility="hidden",b){var r=X(h,b);a.appendChild(r)}if(y){var i=document.createElement("div");i.classList.add("boardhandle"),i.innerHTML='<ul><li><a id="previousboard" href="#" title="Previous board"><i class="fas fa-chevron-up"></i></a></li><li><a id="nextboard" href="#" title="Next board"><i class="fas fa-chevron-down"></i></a></li></ul>',i.querySelector("#previousboard").addEventListener("click",(function(e){e.preventDefault(),de(M-1,!0);var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",type:"setboard",timestamp:Date.now()-I,index:M,status:{mode:T,board:M,color:p}},document.dispatchEvent(t)})),i.querySelector("#nextboard").addEventListener("click",(function(e){e.preventDefault(),de(M+1,!0);var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",type:"setboard",timestamp:Date.now()-I,index:M,status:{mode:T,board:M,color:p}},document.dispatchEvent(t)})),a.appendChild(i)}}var s=document.createElement("img");s.src=c.src,s.id="sponge",s.style.visibility="hidden",s.style.position="absolute",a.appendChild(s),O[n].sponge=s;var l=document.createElement("canvas");l.width=O[n].width,l.height=O[n].height,l.setAttribute("data-chalkboard",n),l.style.cursor=pens[n][p[n]].cursor,a.appendChild(l),O[n].canvas=l,O[n].context=l.getContext("2d"),document.querySelector(".reveal").appendChild(a),O[n].container=a}var Y=[{width:e.getConfig().width,height:e.getConfig().height,data:[]},{width:e.getConfig().width,height:e.getConfig().height,data:[]}],F=null;function J(e){var t=!1;try{for(var n=JSON.parse(e),a=0;a<n.length;a++)O[a].width==n[a].width&&O[a].height==n[a].height||(O[a].scale=Math.min(O[a].width/n[a].width,O[a].height/n[a].height),O[a].xOffset=(O[a].width-n[a].width*O[a].scale)/2,O[a].yOffset=(O[a].height-n[a].height*O[a].scale)/2),x.readOnly&&(O[a].container.style.cursor="default",O[a].canvas.style.cursor="default");t=!0,Y=n}catch(De){console.warn("Cannot initialise storage!")}return t}function K(){var e=JSON.stringify(Y);return x.storage&&sessionStorage.setItem(x.storage,e),e}function U(){for(var e=0;e<2;e++)for(var t=Y[e].data.length-1;t>=0;t--)0==Y[e].data[t].events.length&&Y[e].data.splice(t,1);return K()}function $(e,t){null==t&&(t=T),e||(e=N);for(var n=0;n<Y[t].data.length;n++)if(Y[t].data[n].slide.h===e.h&&Y[t].data[n].slide.v===e.v&&Y[t].data[n].slide.f===e.f)return Y[t].data[n];return Y[t].data.push({slide:e,events:[],duration:0}),Y[t].data[Y[t].data.length-1]}function G(e){e||(e=N);for(var t=0,n=0;n<2;n++)for(var a=0;a<Y[n].data.length;a++)if(Y[n].data[a].slide.h===e.h&&Y[n].data[a].slide.v===e.v&&Y[n].data[a].slide.f===e.f){t=Math.max(t,Y[n].data[a].duration);break}return t}x.storage&&(F=J(sessionStorage.getItem(x.storage))),F||null==x.src||function(e){var t=new XMLHttpRequest;t.onload=function(){4===t.readyState&&404!=t.status?(F=J(t.responseText),console.log("Drawings loaded from file")):(x.readOnly=void 0,k=void 0,console.warn("Failed to get file "+e+". ReadyState: "+t.readyState+", Status: "+t.status),F=!1)},t.open("GET",e,!0);try{t.send()}catch(n){x.readOnly=void 0,k=void 0,console.warn("Failed to get file "+e+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+n),F=!1}}(x.src);var Q=/print-pdf/gi.test(window.location.search);function V(){if(0!=Y[1].data.length){console.log("Create printout(s) for "+Y[1].data.length+" slides"),O[0].container.style.opacity=0,O[0].container.style.visibility="hidden";var e=new Image;e.onload=function(){for(var t=function(){for(var e=document.querySelectorAll(".slides > div.pdf-page > section, .slides > section"),t=[],n=void 0,a=0;a<e.length;a++)if(e[a].parentElement.classList.contains("pdf-page"))e[a].getAttribute("data-slide-number")!=n?(t.push([]),t[t.length-1].push(e[a]),n=e[a].getAttribute("data-slide-number")):t[t.length-1][t[t.length-1].length-1]=e[a];else{var o=e[a].querySelectorAll("section");t.push([]);n=void 0;for(var r=0;r<o.length;r++)o[r].getAttribute("data-slide-number")!=n?(t[t.length-1].push(o[r]),n=o[r].getAttribute("data-slide-number")):t[t.length-1][t[t.length-1].length-1]=o[r]}return t}(),n=Y[1].data.length-1;n>=0;n--){console.log("Create printout for slide "+Y[1].data[n].slide.h+"."+Y[1].data[n].slide.v);var a=_($(Y[1].data[n].slide,1),e);ee(t[Y[1].data[n].slide.h][Y[1].data[n].slide.v],a)}},e.src=t[1]}}function Z(e,t,n){var a,o,r,i=t.findIndex((e=>e.board===n));if(-1===i){var s=(a=e,o=document.createElement("canvas"),r=o.getContext("2d"),o.width=a.width,o.height=a.height,r.drawImage(a,0,0),o);t.length?n<t[0].board?(i=0,t.unshift({board:n,canvas:s})):n>t[t.length-1].board&&(i=t.length,t.push({board:n,canvas:s})):(i=0,t.push({board:n,canvas:s}))}return t[i].canvas}function _(t,a){var o=e.getConfig().width,r=e.getConfig().height,i=1,s=0,l=0;o==Y[1].width&&r==Y[1].height||(i=Math.min(o/Y[1].width,r/Y[1].height),s=(o-Y[1].width*i)/2,l=(r-Y[1].height*i)/2),T=1,M=0,console.log("Create printout(s) for slide ",t);var d=[],c=document.createElement("canvas");c.width=o,c.height=r;var u=c.getContext("2d");u.fillStyle=u.createPattern(a,"repeat"),u.rect(0,0,o,r),u.fill();for(var h=0;h<t.events.length;h++)switch(t.events[h].type){case"draw":for(var g=1;g<t.events[h].curve.length;g++)n[1](Z(c,d,M).getContext("2d"),s+t.events[h].curve[g-1].x*i,l+t.events[h].curve[g-1].y*i,s+t.events[h].curve[g].x*i,l+t.events[h].curve[g].y*i);break;case"erase":for(g=0;g<t.events[h].curve.length;g++)ae(Z(c,d,M).getContext("2d"),s+t.events[h].curve[g].x*i,l+t.events[h].curve[g].y*i);break;case"setcolor":le(t.events[h].index);break;case"setboard":de(t.events[h].index);break;case"clear":Z(c,d,M).getContext("2d").clearRect(0,0,o,r),Z(c,d,M).getContext("2d").fill()}return d=d.sort(((e,t)=>e.board>t.board?1:-1)),T=0,d}function ee(t,n){for(var a=t.parentElement.parentElement,o=t.parentElement.nextElementSibling,r=0;r<n.length;r++){var i=document.createElement("div");i.classList.add("pdf-page"),i.style.height=e.getConfig().height,i.append(n[r].canvas),null!=o?a.insertBefore(i,o):a.append(i)}}function te(e,t,n,a,o){e.lineWidth=i,e.lineCap="round",e.strokeStyle=u[p[T]].color,e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke()}function ne(e,t,n,a,o){var r=s;e.lineWidth=r,e.lineCap="round",e.fillStyle=h[p[T]].color,e.strokeStyle=h[p[T]].color;e.strokeStyle=e.strokeStyle.replace(/[\d\.]+\)$/g,"1)"),e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke();for(var i=Math.round(Math.sqrt(Math.pow(a-t,2)+Math.pow(o-n,2))/(5/r)),d=(a-t)/i,c=(o-n)/i,u=0;u<i;u++)if(l>.9*Math.random()){var g=n+u*c,v=t+u*d+(Math.random()-.5)*r*1.2,f=g+(Math.random()-.5)*r*1.2;e.clearRect(v,f,2*Math.random()+2,Math.random()+1)}}function ae(e,t,n){e.save(),e.beginPath(),e.arc(t,n,c.radius,0,2*Math.PI,!1),e.clip(),e.clearRect(t-c.radius-1,n-c.radius-1,2*c.radius+2,2*c.radius+2),e.restore(),1==T&&r&&function(e,t,n){var a=O[1].context;O[1].scale=Math.min(O[1].width/Y[1].width,O[1].height/Y[1].height),O[1].xOffset=(O[1].width-Y[1].width*O[1].scale)/2,O[1].yOffset=(O[1].height-Y[1].height*O[1].scale)/2;for(var o=O[1].scale,i=(O[1].xOffset,O[1].yOffset,r.distance*o),s=O[1].width/2-i/2-Math.floor((O[1].width-i)/2/i)*i,l=s+i*Math.ceil((e-n-s)/i);l<=s+i*Math.floor((e+n-s)/i);l+=i)a.beginPath(),a.lineWidth=r.width*o,a.lineCap="round",a.fillStyle=r.color,a.strokeStyle=r.color,a.moveTo(l,t-Math.sqrt(n*n-(e-l)*(e-l))),a.lineTo(l,t+Math.sqrt(n*n-(e-l)*(e-l))),a.stroke();for(var d=O[1].height/2-i/2-Math.floor((O[1].height-i)/2/i)*i,c=d+i*Math.ceil((t-n-d)/i);c<=d+i*Math.floor((t+n-d)/i);c+=i)a.beginPath(),a.lineWidth=r.width*o,a.lineCap="round",a.fillStyle=r.color,a.strokeStyle=r.color,a.moveTo(e-Math.sqrt(n*n-(t-c)*(t-c)),c),a.lineTo(e+Math.sqrt(n*n-(t-c)*(t-c)),c),a.stroke()}(t,n,c.radius)}function oe(){clearTimeout(W),W=null,O[0].sponge.style.visibility="hidden",O[1].sponge.style.visibility="hidden",O[1].container.style.opacity=1,O[1].container.style.visibility="visible",T=1}function re(){clearTimeout(W),W=null,O[0].sponge.style.visibility="hidden",O[1].sponge.style.visibility="hidden",O[1].container.style.opacity=0,O[1].container.style.visibility="hidden",P=null,q=null,R=null,T=0}function ie(e){0==e&&clearTimeout(H),O[e].context.clearRect(0,0,O[e].width,O[e].height),1==e&&r&&se()}function se(){var e=O[1].context;O[1].scale=Math.min(O[1].width/Y[1].width,O[1].height/Y[1].height),O[1].xOffset=(O[1].width-Y[1].width*O[1].scale)/2,O[1].yOffset=(O[1].height-Y[1].height*O[1].scale)/2;for(var t=O[1].scale,n=(O[1].xOffset,O[1].yOffset,r.distance*t),a=O[1].width/2-n/2-Math.floor((O[1].width-n)/2/n)*n;a<O[1].width;a+=n)e.beginPath(),e.lineWidth=r.width*t,e.lineCap="round",e.fillStyle=r.color,e.strokeStyle=r.color,e.moveTo(a,0),e.lineTo(a,O[1].height),e.stroke();for(var o=O[1].height/2-n/2-Math.floor((O[1].height-n)/2/n)*n;o<O[1].height;o+=n)e.beginPath(),e.lineWidth=r.width*t,e.lineCap="round",e.fillStyle=r.color,e.strokeStyle=r.color,e.moveTo(0,o),e.lineTo(O[1].width,o),e.stroke()}function le(e,t){e>=u[T].length&&(e=0),p[T]=e,O[T].canvas.style.cursor=pens[T][p[T]].cursor,t&&(ge({type:"setcolor",index:e,begin:Date.now()-I}),K())}function de(e,t){ce(M=e),t&&(ge({type:"setboard",index:M,begin:Date.now()-I}),K())}function ce(e){ie(1);for(var t=$(N,1),n=0,a=0==e;n<t.events.length&&t.events[n].begin<Date.now()-I;)"setboard"==t.events[n].type?a=e==t.events[n].index:(a||"setcolor"==t.events[n].type)&&fe(1,t.events[n],Date.now()-I),n++}var ue=[];function he(){var e=ue.shift();switch(I=Date.now()-e.content.timestamp,T<e.content.status.mode?oe():T>e.content.status.mode&&re(),M!=e.content.status.board&&ce(M=e.content.status.board),p=e.content.status.color,e.content.type){case"showChalkboard":oe();break;case"closeChalkboard":re();break;case"startDrawing":me(e.content.x,e.content.y,e.content.erase);break;case"startErasing":e.content&&(e.content.type="erase",e.content.begin=Date.now()-I,ae(O[T].context,e.content.x,e.content.y));break;case"drawSegment":ye(e.content.x,e.content.y,e.content.erase);break;case"stopDrawing":we();break;case"clear":Ce();break;case"setcolor":le(e.content.index,!0);break;case"setboard":de(e.content.index,!0);break;case"resetSlide":Ee(!0);break;case"init":Y=e.content.storage;for(var t=0;t<2;t++)O[t].scale=Math.min(O[t].width/Y[t].width,O[t].height/Y[t].height),O[t].xOffset=(O[t].width-Y[t].width*O[t].scale)/2,O[t].yOffset=(O[t].height-Y[t].height*O[t].scale)/2;ie(0),ie(1),z||(H=setTimeout(ve,w,G(),0)),1==T&&0==e.content.mode&&setTimeout(re,w+50),0==T&&1==e.content.mode&&setTimeout(oe,w+50),T=e.content.mode}ue.length>0?he():K()}function ge(e){for(var t=$(),n=t.events.length;n>0&&e.begin<t.events[n-1].begin;)n--;t.events.splice(n,0,e),t.duration=Math.max(t.duration,Date.now()-I)+1}function ve(e,t){I=Date.now()-e,re(),T=0,M=0;for(var n=0;n<2;n++){ie(n);for(var a=$(N,n),o=0;o<a.events.length&&a.events[o].begin<Date.now()-I;)fe(n,a.events[o],e),o++;for(;z&&o<a.events.length;)B[n].push(setTimeout(fe,a.events[o].begin-(Date.now()-I),n,a.events[o],e)),o++}null!=t&&(T=t),1==T&&oe()}function pe(){for(var e=0;e<2;e++){for(var t=0;t<B[e].length;t++)clearTimeout(B[e][t]);B[e]=[]}}function fe(e,t,a){switch(t.type){case"open":a<=t.begin?oe():T=1;break;case"close":a<t.begin?re():T=0;break;case"clear":ie(e);break;case"setcolor":le(t.index);break;case"setboard":de(t.index);break;case"draw":!function(e,t){if(t.curve.length>1)for(var a=O[e].context,o=O[e].scale,r=O[e].xOffset,i=O[e].yOffset,s=(t.end-t.begin)/(t.curve.length-1),l=1;l<t.curve.length;l++)t.begin+l*s<=Date.now()-I?n[e](a,r+t.curve[l-1].x*o,i+t.curve[l-1].y*o,r+t.curve[l].x*o,i+t.curve[l].y*o):z&&B.push(setTimeout(n[e],Math.max(0,t.begin+l*s-(Date.now()-I)),a,r+t.curve[l-1].x*o,i+t.curve[l-1].y*o,r+t.curve[l].x*o,i+t.curve[l].y*o))}(e,t);break;case"erase":!function(e,t){if(t.curve.length>1)for(var n=O[e].context,a=O[e].scale,o=O[e].xOffset,r=O[e].yOffset,i=(t.end-t.begin)/t.curve.length,s=0;s<t.curve.length;s++)t.begin+s*i<=Date.now()-I?ae(n,o+t.curve[s].x*a,r+t.curve[s].y*a):z&&B.push(setTimeout(ae,Math.max(0,t.begin+s*i-(Date.now()-I)),n,o+t.curve[s].x*a,r+t.curve[s].y*a))}(e,t)}}function me(e,t,n){var a=O[T].context,o=O[T].scale,r=O[T].xOffset,i=O[T].yOffset;P=e*o+r,q=t*o+i,1==n?(R={type:"erase",begin:Date.now()-I,end:null,curve:[{x:e,y:t}]},O[T].canvas.style.cursor='url("'+c.src+'") '+c.radius+" "+c.radius+", auto",ae(a,e*o+r,t*o+i)):R={type:"draw",begin:Date.now()-I,end:null,curve:[{x:e,y:t}]}}function be(e,t){if(R){R.type="erase",R.begin=Date.now()-I,O[T].sponge.style.left=e-c.radius+"px",O[T].sponge.style.top=t-c.radius+"px",O[T].sponge.style.visibility="visible",ae(O[T].context,e,t);var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"startErasing",timestamp:Date.now()-I,status:{mode:T,board:M,color:p},x:(L-xOffset)/scale,y:(A-yOffset)/scale},document.dispatchEvent(n)}}function ye(e,t,a){var o=O[T].context,r=O[T].scale,i=O[T].xOffset,s=O[T].yOffset;R||me(e,t,a),R.curve.push({x:e,y:t}),t*r+s<O[T].height&&e*r+i<O[T].width&&(a?ae(o,e*r+i,t*r+s):n[T](o,P,q,e*r+i,t*r+s),P=e*r+i,q=t*r+s)}function we(){R&&(R.end=Date.now()-I,("erase"==R.type||R.curve.length>1)&&(ge(R),K()),R=null)}function ke(){if(1==T)R=null,k||(ge({type:"close",begin:Date.now()-I}),K()),re(),(e=new CustomEvent(C)).content={sender:"chalkboard-plugin",type:"closeChalkboard",timestamp:Date.now()-I,status:{mode:T,board:M,color:p}},document.dispatchEvent(e);else if(oe(),!k){var e;ge({type:"open",begin:Date.now()-I}),(e=new CustomEvent(C)).content={sender:"chalkboard-plugin",type:"showChalkboard",timestamp:Date.now()-I,status:{mode:T,board:M,color:p}},document.dispatchEvent(e);var t=0;d[T]&&(t=p[T]),le(t,!0),(e=new CustomEvent(C)).content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:t,status:{mode:T,board:M,color:p}},document.dispatchEvent(e)}}function Ce(){if(!k){ge({type:"clear",begin:Date.now()-I}),ie(T);var e=new CustomEvent(C);e.content={sender:"chalkboard-plugin",type:"clear",timestamp:Date.now()-I,status:{mode:T,board:M,color:p}},document.dispatchEvent(e)}}function xe(e){if(!k){le(e,!0);var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:e,status:{mode:T,board:M,color:p}},document.dispatchEvent(t)}}function Ee(e){if(e||confirm("Please confirm to delete chalkboard drawings on this slide!")){var t;pe(),I=Date.now(),R=null,re(),ie(0),ie(1),T=1,(t=$()).duration=0,t.events=[],T=0,(t=$()).duration=0,t.events=[],K();var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"resetSlide",timestamp:Date.now()-I,status:{mode:T,board:M,color:p}},document.dispatchEvent(n)}}for(var E in document.addEventListener("received",(function(e){e.content&&"chalkboard-plugin"==e.content.sender&&ue.push(e),1==ue.length&&he()})),document.addEventListener("welcome",(function(e){var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",recipient:e.id,type:"init",timestamp:Date.now()-I,storage:Y,status:{mode:T,board:M,color:p}},document.dispatchEvent(t)})),document.addEventListener("seekplayback",(function(e){pe(),z&&0!=e.timestamp||ve(e.timestamp)})),document.addEventListener("startplayback",(function(e){pe(),z=!0,ve(e.timestamp)})),document.addEventListener("stopplayback",(function(e){z=!1,pe()})),document.addEventListener("startrecording",(function(e){Ee(!0),I=Date.now()})),document.addEventListener("touchstart",(function(e){if(!k&&e.target.getAttribute("data-chalkboard")==T){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset;e.preventDefault();var o=e.touches[0];L=o.pageX,A=o.pageY,me((L-n)/t,(A-a)/t,!1);var r=new CustomEvent(C);r.content={sender:"chalkboard-plugin",type:"startDrawing",timestamp:Date.now()-I,status:{mode:T,board:M,color:p},x:(L-n)/t,y:(A-a)/t,erase:!1},document.dispatchEvent(r),W=setTimeout(be,500,L,A)}}),!!a&&{passive:!1}),document.addEventListener("touchmove",(function(e){if(clearTimeout(W),W=null,R){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset,o=e.touches[0];L=o.pageX,(A=o.pageY)<O[T].height&&L<O[T].width&&(e.preventDefault(),"erase"==R.type&&(O[T].sponge.style.left=L-c.radius+"px",O[T].sponge.style.top=A-c.radius+"px")),ye((L-n)/t,(A-a)/t,"erase"==R.type);var r=new CustomEvent(C);r.content={sender:"chalkboard-plugin",type:"drawSegment",timestamp:Date.now()-I,status:{mode:T,board:M,color:p},x:(L-n)/t,y:(A-a)/t,erase:"erase"==R.type},document.dispatchEvent(r)}}),!1),document.addEventListener("touchend",(function(e){clearTimeout(W),W=null,O[T].sponge.style.visibility="hidden",we();var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",timestamp:Date.now()-I,type:"stopDrawing",status:{mode:T,board:M,color:p}},document.dispatchEvent(t)}),!1),document.addEventListener("mousedown",(function(e){if(!k&&e.target.getAttribute("data-chalkboard")==T){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset;L=e.pageX,A=e.pageY,me((L-n)/t,(A-a)/t,2==e.button||1==e.button);var o=new CustomEvent(C);o.content={sender:"chalkboard-plugin",type:"startDrawing",timestamp:Date.now()-I,status:{mode:T,board:M,color:p},x:(L-n)/t,y:(A-a)/t,erase:2==e.button||1==e.button},document.dispatchEvent(o)}})),document.addEventListener("mousemove",(function(e){if(R){var t=O[T].scale,n=O[T].xOffset,a=O[T].yOffset;L=e.pageX,A=e.pageY,ye((L-n)/t,(A-a)/t,"erase"==R.type);var o=new CustomEvent(C);o.content={sender:"chalkboard-plugin",type:"drawSegment",timestamp:Date.now()-I,status:{mode:T,board:M,color:p},x:(L-n)/t,y:(A-a)/t,erase:"erase"==R.type},document.dispatchEvent(o)}})),document.addEventListener("mouseup",(function(e){if(O[T].canvas.style.cursor=pens[T][p[T]].cursor,R){we();var t=new CustomEvent(C);t.content={sender:"chalkboard-plugin",type:"stopDrawing",timestamp:Date.now()-I,status:{mode:T,board:M,color:p}},document.dispatchEvent(t)}})),window.addEventListener("resize",(function(){var e=Date.now()-I;z||(e=G());for(var t=0;t<2;t++)O[t].width=window.innerWidth,O[t].height=window.innerHeight,O[t].canvas.width=O[t].width,O[t].canvas.height=O[t].height,O[t].context.canvas.width=O[t].width,O[t].context.canvas.height=O[t].height,O[t].scale=Math.min(O[t].width/Y[t].width,O[t].height/Y[t].height),O[t].xOffset=(O[t].width-Y[t].width*O[t].scale)/2,O[t].yOffset=(O[t].height-Y[t].height*O[t].scale)/2;ve(e,T)})),e.addEventListener("ready",(function(t){if(Q)console.log("Create printouts when ready"),S(V);else{if(I=Date.now()-G(),N=e.getIndices(),z||ve(G(),0),e.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}K()}})),e.addEventListener("slidechanged",(function(t){if(!Q){if(I=Date.now()-G(),N=e.getIndices(),re(),ie(0),ie(1),z||(H=setTimeout(ve,w,G(),0)),e.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}K()}})),e.addEventListener("fragmentshown",(function(t){if(!Q)if(I=Date.now()-G(),N=e.getIndices(),re(),ie(0),ie(1),e.isAutoSliding()){var n=new CustomEvent("startplayback");n.timestamp=0,document.dispatchEvent(n)}else z||ve(G(),0)})),e.addEventListener("fragmenthidden",(function(t){Q||(I=Date.now()-G(),N=e.getIndices(),re(),ie(0),ie(1),e.isAutoSliding()?document.dispatchEvent(new CustomEvent("stopplayback")):z||(ve(G()),re()))})),e.addEventListener("autoslideresumed",(function(e){var t=new CustomEvent("startplayback");t.timestamp=0,document.dispatchEvent(t)})),e.addEventListener("autoslidepaused",(function(e){document.dispatchEvent(new CustomEvent("stopplayback")),ve(G(),0)})),this.toggleNotesCanvas=function(){if(!k)if(1==T)ke(),notescanvas.style.background=t[0],notescanvas.style.pointerEvents="auto";else if("none"!=notescanvas.style.pointerEvents)b&&(notescanvas.querySelector(".palette").style.visibility="hidden"),R=null,notescanvas.style.background="rgba(0,0,0,0)",notescanvas.style.pointerEvents="none";else{b&&(notescanvas.querySelector(".palette").style.visibility="visible"),notescanvas.style.background=t[0],notescanvas.style.pointerEvents="auto";var e=0;p[T]&&(e=p[T]),le(e,!0);var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,status:{mode:T,board:M,color:p},index:e},document.dispatchEvent(n)}},this.toggleChalkboard=ke,this.colorIndex=xe,this.colorNext=function(){if(!k){let t=(p[T]=(p[T]+1)%pens[T].length,p[T]);le(t,!0);var e=new CustomEvent(C);e.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:t,status:{mode:T,board:M,color:p}},document.dispatchEvent(e)}},this.colorPrev=function(){if(!k){let t=(p[T]=(p[T]+(pens[T].length-1))%pens[T].length,p[T]);le(t,!0);var e=new CustomEvent(C);e.content={sender:"chalkboard-plugin",type:"setcolor",timestamp:Date.now()-I,index:t,status:{mode:T,board:M,color:p}},document.dispatchEvent(e)}},this.clear=Ce,this.reset=Ee,this.resetAll=function(t){if(t||confirm("Please confirm to delete all chalkboard drawings!")){pe(),I=Date.now(),ie(0),ie(1),1==T&&(R=null,re()),Y=[{width:e.getConfig().width,height:e.getConfig().height,data:[]},{width:e.getConfig().width,height:e.getConfig().height,data:[]}],x.storage&&sessionStorage.setItem(x.storage,null);var n=new CustomEvent(C);n.content={sender:"chalkboard-plugin",type:"init",timestamp:Date.now()-I,storage:Y,status:{mode:T,board:M,color:p}},document.dispatchEvent(n)}},this.download=function(){var e=document.createElement("a");document.body.appendChild(e);try{e.download="chalkboard.json";var t=new Blob([U()],{type:"application/json"});e.href=window.URL.createObjectURL(t)}catch(n){e.innerHTML+=" ("+n+")"}e.click(),document.body.removeChild(e)},this.updateStorage=K,this.getData=U,this.configure=D,g)g[E]&&e.addKeyBinding(g[E],RevealChalkboard[E]);return this};