function defaultLogger(e){console.log(e)}window.RevealSeminar=window.RevealSeminar||{id:"RevealSeminar",init:function(e){initSeminar(e)},open_or_join_room:function(e,n){checkin(n),open_or_join_room(e)},join_room:function(e){checkin(e),join_room()},leave_room:function(){leave_room()},close_room:function(e){close_room(e)},connected:function(){return connected()},hosting:function(){return hosting()}};const initSeminar=function(e){var n=e.getConfig().seminar||{};if(!n.server)return void alert("Seminar server not specified!");if(n.url=n.url||window.location.host,n.room=n.room||n.url,!n.hash)return void alert("Hash not specified!");const o=window[n.logger||"defaultLogger"];var t=io.connect(n.server);n.callback&&o("connect to ",n.server),t.on("connect",(function(){o("connected to "+n.server)}));const r={CHECKEDIN:1,JOINING:2,JOINED:3,HOSTING:4,CHAIRING:5};var i=null,c=null;function a(){var e=new CustomEvent("seminar");e.status=c,document.dispatchEvent(e)}function s(e){c&&e&&i!=e&&(t.emit("checkout"),c=null),c||(i=e||i||t.id,t.emit("checkin",i,(function(e){e?o(e):(c=r.CHECKEDIN,a(),o(`checked in as ${i}`))})))}function m(i){c>=r.HOSTING?o("already hosting, ignoring request to host"):(c==r.JOINED&&u(),c==r.JOINING&&(c=r.CHECKEDIN,a()),t.emit("host_room",{venue:n.url,name:n.room,hash:n.hash,secret:i},(function(t){t?o(t):(c=Math.max(c,r.HOSTING),a(),o(`host room "${n.url}|${n.room}|${n.hash}"`),function(){if(window.location.search.match(/receiver/gi))return;d(),e.on("slidechanged",v),e.on("fragmentshown",v),e.on("fragmenthidden",v),e.on("overviewhidden",v),e.on("overviewshown",v),e.on("paused",v),e.on("resumed",v),document.addEventListener("broadcast",(function(e){e&&!e.recipient&&v(e)}))}())})))}function u(){t.emit("leave_room",{venue:n.url,name:n.room,hash:n.hash},(function(e){e?o(e):(c=r.CHECKEDIN,a(),o(`left room "${n.url}|${n.room}|${n.hash}"`))}))}function h(){t.emit("join_room",{venue:n.url,name:n.room,hash:n.hash},(function(e){o(`try to join room "${n.url}|${n.room}|${n.hash}"`),e?(o(e),c=r.JOINING,a()):(o(`joined room "${n.url}|${n.room}|${n.hash}" as ${t.id}`),d(),c=r.JOINED,a())}))}function d(){document.addEventListener("send",(function(e){e&&function(e){var o={venue:n.url,name:n.room,hash:n.hash,recipient:(e.content||{}).recipient,copy:(e.content||{}).copy,content:e.content};o.content&&(delete o.content.recipient,delete o.content.copy),t.emit("message",o)}(e)}))}function v(o){var r={venue:n.url,name:n.room,hash:n.hash,recipient:null,copy:(o.content||{}).copy,content:{state:e.getState(),custom:(o||{}).content}};r.content&&(delete r.content.recipient,delete r.content.copy),t.emit("announcement",r)}return t.on("room_opened",(e=>{o(`room opened "${e.venue}|${e.name}|..."`),c==r.JOINING&&e.venue==n.url&&e.name==n.room&&h()})),t.on("kicked_out",(e=>{if(o(`kicked out of room "${e.venue}|${e.name}|${e.hash}"`),u(),c>=r.JOINED){var n=new CustomEvent("kicked_out");n.content=e,document.dispatchEvent(n),c=r.JOINING,a()}})),t.on("chair",(e=>{o(`chairing room "${e.venue}|${e.name}|${e.hash}"`),c=r.CHAIRING,a()})),t.on("participants",(({room:e,hosts:o,participants:t})=>{if(e.venue==n.url&&e.name==n.room&&e.hash==n.hash){var r=new CustomEvent("participants");r.content={hosts:o,participants:t},document.dispatchEvent(r)}})),t.on("entered_room",(({room:e,user:t})=>{if(e.venue==n.url&&e.name==n.room&&e.hash==n.hash&&(o(`${t.id} entered room "${e.venue}|${e.name}|${e.hash}"`),c==r.CHAIRING)){var i=new CustomEvent("welcome");i.content={user:t},document.dispatchEvent(i)}})),t.on("announcement",(({time:o,room:t,sender:r,content:i})=>{if(t.venue==n.url&&t.name==n.room&&t.hash==n.hash&&(i.state&&i.state!=e.getState()&&e.setState(i.state),i.custom)){var c=new CustomEvent("received");c.content=i.custom,document.dispatchEvent(c)}})),t.on("message",(({time:e,room:o,sender:t,content:r})=>{if(o.venue==n.url&&o.name==n.room&&o.hash==n.hash&&r){var i=new CustomEvent("received");i.content=r,document.dispatchEvent(i)}})),n.autoJoin&&n.url&&n.room&&n.hash&&(s(),n.secret?m(n.secret):h()),this.checkin=s,this.open_or_join_room=m,this.join_room=h,this.leave_room=u,this.close_room=function(e){t.emit("close_room",{venue:n.url,name:n.room,hash:n.hash,secret:e},(function(e){e?o(e):(c=r.CHECKEDIN,a(),o(`room closed "${n.url}|${n.room}|${n.hash}"`))}))},this.connected=function(){return c>=r.JOINED},this.hosting=function(){return c>=r.HOSTING},this};