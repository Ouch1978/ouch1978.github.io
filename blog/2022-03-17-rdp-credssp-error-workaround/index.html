<!doctype html>
<html lang="zh-TW" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="OUCH1978@GITHUB RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="OUCH1978@GITHUB Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-20523508-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="OUCH1978@GITHUB" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&amp;display=swap" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" async></script>
<script src="/assets/enablePangu.js" async></script><title data-rh="true">遠端桌面連線出現因為 CredSSP 加密 Oracle 補救造成無法連線的應急解法 | OUCH1978@GITHUB</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ouch1978.github.io/blog/2022-03-17-rdp-credssp-error-workaround"><meta data-rh="true" name="docusaurus_locale" content="zh-TW"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-TW"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="遠端桌面連線出現因為 CredSSP 加密 Oracle 補救造成無法連線的應急解法 | OUCH1978@GITHUB"><meta data-rh="true" name="description" content="前言"><meta data-rh="true" property="og:description" content="前言"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-03-17T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/ouch1978"><meta data-rh="true" property="article:tag" content="windows 10,CredSSP,rdp,remote desktop"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ouch1978.github.io/blog/2022-03-17-rdp-credssp-error-workaround"><link data-rh="true" rel="alternate" href="https://ouch1978.github.io/blog/2022-03-17-rdp-credssp-error-workaround" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://ouch1978.github.io/blog/2022-03-17-rdp-credssp-error-workaround" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://AG6O0X1DB7-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.0c640ca0.css">
<link rel="preload" href="/assets/js/runtime~main.553eee41.js" as="script">
<link rel="preload" href="/assets/js/main.f464c3d6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.png" alt="Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">OUCH1978@GITHUB</b></a><a class="navbar__item navbar__link" href="/docs/docs-intro">文件庫</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">部落格</a></div><div class="navbar__items navbar__items--right"><a href="/slides" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">投影片</a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1" itemscope="" itemtype="http://schema.org/Blog"><div class="sc-gsnTZi zLxxN"><div class="row" style="margin:0px"><div class="col col--12 article__details"><article><header><h1 class="blogPostTitle_uMeh" itemprop="headline">遠端桌面連線出現因為 CredSSP 加密 Oracle 補救造成無法連線的應急解法</h1><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/ouch1978" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://avatars.githubusercontent.com/u/18132883?v=4" alt="Ouch Liu"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/ouch1978" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Ouch Liu</span></a></div><small class="avatar__subtitle" itemprop="description">不務正業的架構師</small></div></div></div></div></header><p class="single-post--date text--center"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="calendar-plus" class="svg-inline--fa fa-calendar-plus margin-right--md" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M96 32C96 14.33 110.3 0 128 0C145.7 0 160 14.33 160 32V64H288V32C288 14.33 302.3 0 320 0C337.7 0 352 14.33 352 32V64H400C426.5 64 448 85.49 448 112V160H0V112C0 85.49 21.49 64 48 64H96V32zM448 464C448 490.5 426.5 512 400 512H48C21.49 512 0 490.5 0 464V192H448V464zM200 272V328H144C130.7 328 120 338.7 120 352C120 365.3 130.7 376 144 376H200V432C200 445.3 210.7 456 224 456C237.3 456 248 445.3 248 432V376H304C317.3 376 328 365.3 328 352C328 338.7 317.3 328 304 328H248V272C248 258.7 237.3 248 224 248C210.7 248 200 258.7 200 272z"></path></svg><time datetime="2022-03-17T00:00:00.000Z" itemprop="datePublished">2022年3月17日</time><br><br><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="clock" class="svg-inline--fa fa-clock margin-right--md" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512zM232 256C232 264 236 271.5 242.7 275.1L338.7 339.1C349.7 347.3 364.6 344.3 371.1 333.3C379.3 322.3 376.3 307.4 365.3 300L280 243.2V120C280 106.7 269.3 96 255.1 96C242.7 96 231.1 106.7 231.1 120L232 256z"></path></svg>預估閱讀時間： 4 分鐘</p><div class="text--center margin-bottom--xs padding-bottom--xs"><div class="post__tags-container margin-bottom--md"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags margin-right--md" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M472.8 168.4C525.1 221.4 525.1 306.6 472.8 359.6L360.8 472.9C351.5 482.3 336.3 482.4 326.9 473.1C317.4 463.8 317.4 448.6 326.7 439.1L438.6 325.9C472.5 291.6 472.5 236.4 438.6 202.1L310.9 72.87C301.5 63.44 301.6 48.25 311.1 38.93C320.5 29.61 335.7 29.7 344.1 39.13L472.8 168.4zM.0003 229.5V80C.0003 53.49 21.49 32 48 32H197.5C214.5 32 230.7 38.74 242.7 50.75L410.7 218.7C435.7 243.7 435.7 284.3 410.7 309.3L277.3 442.7C252.3 467.7 211.7 467.7 186.7 442.7L18.75 274.7C6.743 262.7 0 246.5 0 229.5L.0003 229.5zM112 112C94.33 112 80 126.3 80 144C80 161.7 94.33 176 112 176C129.7 176 144 161.7 144 144C144 126.3 129.7 112 112 112z"></path></svg><a class="post__tags margin-right--sm" style="font-size:0.75em;font-weight:500" href="/blog/tags/windows-10">windows 10</a><a class="post__tags margin-horiz--sm" style="font-size:0.75em;font-weight:500" href="/blog/tags/cred-ssp">CredSSP</a><a class="post__tags margin-horiz--sm" style="font-size:0.75em;font-weight:500" href="/blog/tags/rdp">rdp</a><a class="post__tags margin-horiz--sm" style="font-size:0.75em;font-weight:500" href="/blog/tags/remote-desktop">remote desktop</a></div></div><section class="sc-bczRLJ bdeZVr markdown"><h2 class="anchor anchorWithStickyNavbar_mojV" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>最近要使用遠端桌面連線到某台 Windows Server 的時候，出現了以下這個錯誤：</p><p><img loading="lazy" alt="出現因 CredSSP 加密 Oracle 補救造成的錯誤" src="/assets/images/credssp-encryption-oracle-remediation-error-fe082b107a601c9dd021d8e633b1df67.png" title="出現因 CredSSP 加密 Oracle 補救造成的錯誤" width="585" height="235" class="img_E7b_"></p><p>雖然說這已經不是第一次看到了，不過只要一換電腦就又得要再撞到一次，就還是順手寫個筆記記錄一下。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="原因與解法">原因與解法<a class="hash-link" href="#原因與解法" title="Direct link to heading">​</a></h2><p>簡單的說，這個問題會發生，是因為微軟在 2018 年四月針對遠端桌面連線功能釋出了一個安全性的更新，以解決 CredSSP 在連線過程中可能產生的弱點。</p><p>但是這個安全更新得要同時存在於本地端電腦和遠端電腦，本地端才能正常的連線到遠端，只要有一邊沒安裝這個更新，那就會出現這個錯誤。</p><p>而通常都是遠端(Server)沒裝更新造成這個錯誤訊息跑出來，所以最佳解當然就是大家都乖乖的安裝該更新檔。</p><p>如果你手邊剛好有電腦還沒安裝該更新檔的話，可以透過<a href="https://www.catalog.update.microsoft.com/Search.aspx?q=KB4093120" target="_blank" rel="noopener noreferrer" title="KB4093120">這個網址</a>下載。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="應急解法">應急解法<a class="hash-link" href="#應急解法" title="Direct link to heading">​</a></h2><p>雖然說有官方建議的最佳解，但是我們都連不上 Server 了，怎麼幫 Server 更新咧?</p><p>沒關係，山不轉路轉!! 接下來就分享兩招應急措施：</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="修改群組原則">修改群組原則<a class="hash-link" href="#修改群組原則" title="Direct link to heading">​</a></h3><p>如果很不幸的，你的電腦有加入網域，又碰巧你不是管理員、不能修改群組原則的話，請直接跳到下一個方法。</p><p>如果你可以調整群組原則的話，就可以依照<a href="https://support.microsoft.com/zh-tw/topic/cve-2018-0886-%E7%9A%84-credssp-%E6%9B%B4%E6%96%B0-5cbf9e5f-dc6d-744f-9e97-7ba400d6d3ea" target="_blank" rel="noopener noreferrer" title="CVE-2018-0886 的 CredSSP 更新">微軟官方文件</a>中<code>互通性矩陣</code>一節中的內容來調整設定，讓本機可以連到遠端伺服器。</p><p><img loading="lazy" alt="互通性矩陣" src="/assets/images/cve-2018-0886-interoperability-matrix-f7572bcece9898b9f2b3b25beeaa48da.png" title="互通性矩陣" width="790" height="611" class="img_E7b_"></p><p>修改群組原則的流程如下：</p><ol><li><p>按下 <kbd>⊞ Win</kbd> + <kbd>R</kbd> 鍵，輸入 <code>gpedit.msc</code> 開啟群組原則編輯器。</p></li><li><p>點選 <code>Computer Configuration</code>(電腦設定)。</p></li><li><p>點選 <code>Administrative Templates</code>(系統管理範本)。</p></li><li><p>點選 <code>System</code>(系統)。</p></li><li><p>點選 <code>Credentials Delegation</code>(認證委派)。</p></li><li><p>雙擊右邊的 <code>Encryption Oracle Remediation</code>(加密 Oracle 補救) 開啟設定畫面。</p></li><li><p>點選 Encryption Oracle Remediation 視窗裡的的 <code>Enabled</code>(已啟用) 選項。</p></li><li><p>在下方的 <code>Protection Level</code>(保護層級) 下拉選單中選擇 <code>Vulnerable</code>(易受攻擊)。</p></li><li><p>按下右下角的 <code>確定</code>(OK) 按鈕。</p></li></ol><p>完成上述步驟之後，<strong>不用</strong>重新開機，就可以順利連上遠端的機器囉!!</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="修改本地端的登錄機碼">修改本地端的登錄機碼<a class="hash-link" href="#修改本地端的登錄機碼" title="Direct link to heading">​</a></h3><p>這個方法相較於修改群組原則來得簡單得多，只需要開啟命令提示字元，輸入下列指令：</p><div class="codeBlockContainer_I0IT language-powershell theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-powershell codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">reg add &quot;HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\CredSSP\Parameters&quot; /f /v AllowEncryptionOracle /t REG_DWORD /d 2</span><br></span></code></pre><button type="button" aria-label="複製程式碼到剪貼簿" title="複製" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>執行完畢後，也<strong>不用</strong>重新開機，就可以順利連上遠端的機器囉!!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="參考資料">參考資料<a class="hash-link" href="#參考資料" title="Direct link to heading">​</a></h2><p><a href="https://support.microsoft.com/zh-tw/topic/cve-2018-0886-%E7%9A%84-credssp-%E6%9B%B4%E6%96%B0-5cbf9e5f-dc6d-744f-9e97-7ba400d6d3ea" target="_blank" rel="noopener noreferrer" title="CVE-2018-0886 的 CredSSP 更新">CVE-2018-0886 的 CredSSP 更新</a></p></section></article><footer class="article__footer padding-top--md margin-top--lg margin-bottom--lg"><div class="col margin-top--sm"><a href="https://github.com/ouch1978/ouch1978.github.io/edit/main/blog/2022-03-17-rdp-credssp-error-workaround/2022-03-17-rdp-credssp-error-workaround.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>編輯本頁</a></div></footer></div></div></div><div id="disqus_thread"></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2022-03-18-clone-all-repositories-in-gitlab-at-once"><div class="pagination-nav__sublabel">下一篇</div><div class="pagination-nav__label">還在一個一個專案 Clone 嗎? 用這招一次 Clone 所有在 GitLab 上的 Repo!!</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2018-11-08-blog-with-jekyll-and-docker"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">透過 Docker 執行 Jekyll 產出部落格文章</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前言" class="table-of-contents__link toc-highlight">前言</a></li><li><a href="#原因與解法" class="table-of-contents__link toc-highlight">原因與解法</a></li><li><a href="#應急解法" class="table-of-contents__link toc-highlight">應急解法</a><ul><li><a href="#修改群組原則" class="table-of-contents__link toc-highlight">修改群組原則</a></li><li><a href="#修改本地端的登錄機碼" class="table-of-contents__link toc-highlight">修改本地端的登錄機碼</a></li></ul></li><li><a href="#參考資料" class="table-of-contents__link toc-highlight">參考資料</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Ouch Liu(劉耀群). Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.553eee41.js"></script>
<script src="/assets/js/main.f464c3d6.js"></script>
</body>
</html>